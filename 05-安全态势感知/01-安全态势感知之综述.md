2020-02-11

# 一、为什么需要态势感知？
在传统的安全工作情况下，大家部署了各种安全设备，包括主动防御、被动防御措施，但安全数据集都是信息孤岛，不利于统一的分析。
在安全建设发展到一定程度，再通过简单的购买安全设备，很难再提高企业的安全能力，这个时候需要进一步提高安全运营水平，通过日志分析提升主动防御能力。

后来流行了soc（安全运营中心），收集各类日志。大概是近5年，演变为安全态势感知，这个名字更大上一些，它跟soc的区别有：数据源有流量数据、有威胁情报，数据处理上使用了大数据、全文检索的能力。
理论上有预测能力才能叫态势感知，但现实中，其实我觉得基本都没有预测能力，最多有预警能力（威胁情报，结合资产，进行预警、事件响应）。预测的话应该用上ai算法做复杂的分析，增加非特征检测的技术，找出潜在的威胁、攻击。（原来的都是安全设备基于特征检测，然后人们再去处理）

# 二、态势感知的目标
在安全对抗的环境下，如何快速的发现攻击、定位攻击，然后去阻断攻击。
像在2019年护网行动中，大多数企业的主要工作就是检测攻击、封IP（当然前期的工作也有很多）

# 三、态势感知的核心模块

0、资产是基础，如果搞不清楚资产，那么所谓的态势感知工作基本无法开展，资产掌握的越详细、安全分析的难度越小。

1、日志采集：安全设备（ids、ips、fw、堡垒机），路由交换的异常流量netflow，威胁情报，资产数据导入、漏洞数据，采集的话，可以用采集器、接口。

2、数据处理：标准化、存入es，hadoop，全文检索。不用登陆其他设备来看了。

3、可视化：实时态势，攻击的历史数据，资产的健康度。
 
4、事件管理：事件响应，流程闭环。

# 四、分析场景示例（所谓的建模分析，但没用ai算法）
## 需要解决的问题：
1、是真实的攻击吗？是别人扫描器？————安全设备可以识别，也通过web日志也可以发现。404错误、403
2、是什么性质的攻击？定向的攻击，还是随意的攻击？
3、可能影响的范围
## 场景
场景：比如发现了大量的扫描行为，后面基于这个源ip，又有一些http请求，那么可能就是一个先做扫描的信息收集、后面人工渗透的场景。
场景：异常流量，基于netflow数据，发现某个机器一直在请求内网其他主机的8009端口（幽灵猫）、22端口（密码爆破）

# 五、攻击链条分析

开展一次网络攻击的关键步骤：信息搜集、确定攻击方案、寻找突破口、稳固据点 控制目标、横向攻击。
如何遏制攻击的攻击链？
事前：预防（收缩攻击面、修补漏洞 加固系统）
事中：检测（ids、ips），陷阱欺骗（蜜罐、蜜网），干扰攻击
事后：修复、加固

## 六、阿里云给的坚固建议
* 攻击面梳理，资产、漏洞
* 双因素认证
* 部署主机检测响应系统(EDR)，监控来⾃非信任范围的运维操作，记录全量命令和操作调用并审计，⾮白名单进 程禁止执行，⿊黑客常⽤工具md5执⾏均为异常告警; （可能可以防0day漏洞）

* 统⼀一运维管理理路路径:运维操作均⾛走特定IP堡垒机，堡垒机之外均为⼊入侵事件; 

* 对核⼼目标建⽴白名单规则:特定IP及人员才能访问核⼼系统，之外认定为入侵; 

* 防守⽅方全局共享恶意IP:实现攻击IP的“⼀一点监测、全局阻断”; 

========
# 七、高层次的态势感知
安全设备之间能够联动，例如ids发现告警、防火墙去封禁IP，自动化完成。   
但封ip也有一些风险，误伤正常用户，例如nat的ip。可以临时封禁20分钟，看实际情况制定封禁策略。
